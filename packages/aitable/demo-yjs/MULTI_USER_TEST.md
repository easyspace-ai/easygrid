# 多用户实时协作测试指南

## 测试步骤

### 1. 启动后端服务
确保后端服务正在运行:
```bash
cd server
go run cmd/server/main.go serve
```

### 2. 启动前端服务
前端服务已在端口3030启动:
```bash
cd packages/aitable/demo-yjs
pnpm dev
```

### 3. 多用户测试

#### 方法1: 浏览器多标签页测试
1. 打开浏览器访问 `http://localhost:3030`
2. 使用测试账号登录:
   - 邮箱: `admin@126.com`
   - 密码: `Pmker123`
3. 打开第二个标签页，访问 `http://localhost:3030`
4. 使用相同账号登录
5. 在两个标签页中同时编辑表格单元格
6. 观察实时同步效果

#### 方法2: 浏览器多窗口测试
1. 打开两个浏览器窗口
2. 分别访问 `http://localhost:3030`
3. 使用相同账号登录
4. 同时编辑不同单元格
5. 验证实时同步

### 4. 测试场景

#### 场景1: 单元格编辑同步
- 用户A编辑单元格A1
- 用户B应该立即看到A1的变化
- 用户B编辑单元格B1
- 用户A应该立即看到B1的变化

#### 场景2: 添加记录同步
- 用户A点击"添加记录"按钮
- 用户B应该立即看到新记录出现
- 用户B编辑新记录的某个字段
- 用户A应该立即看到字段变化

#### 场景3: 添加字段同步
- 用户A点击"添加字段"按钮
- 用户B应该立即看到新列出现
- 用户B在新列中编辑数据
- 用户A应该立即看到数据变化

### 5. 预期结果

✅ **连接状态**: 两个窗口都显示"实时连接"状态
✅ **实时同步**: 编辑操作在1-2秒内同步到其他窗口
✅ **数据一致性**: 所有窗口显示相同的数据
✅ **错误处理**: 网络断开时显示"离线"状态，重连后自动恢复

### 6. 故障排除

#### 连接失败
- 检查后端服务是否运行在端口2345
- 检查WebSocket连接是否正常
- 查看浏览器控制台错误信息

#### 同步延迟
- 检查网络连接
- 查看ShareDB连接状态
- 检查后端日志

#### 数据不一致
- 刷新页面重新加载数据
- 检查ShareDB文档订阅状态
- 查看控制台错误信息

## 技术验证

### ShareDB连接验证
在浏览器控制台执行:
```javascript
// 检查SDK实例
console.log(window.EasyGridSDK)

// 检查连接状态
// 这需要在组件内部访问
```

### 网络请求验证
在浏览器网络面板中查看:
- HTTP API请求 (端口2345)
- WebSocket连接 (ws://localhost:2345/socket)

## 性能指标

- **连接建立时间**: < 2秒
- **同步延迟**: < 1秒
- **内存使用**: 合理范围内
- **CPU使用**: 低负载

## 测试完成标准

- [ ] 两个窗口都能正常登录
- [ ] 连接状态显示"实时连接"
- [ ] 单元格编辑实时同步
- [ ] 添加记录实时同步
- [ ] 添加字段实时同步
- [ ] 网络断开后重连正常
- [ ] 无JavaScript错误
- [ ] 性能表现良好
